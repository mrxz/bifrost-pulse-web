<!DOCTYPE html>
<html>
    <head>
        <title>Bifrost Pulse Web - Example</title>
        <meta charset="utf-8">
        <script type="importmap">
            {
                "imports": {
                    "bifrost-pulse-web": "./lib/bifrost-pulse-web.js"
                }
            }
        </script>
        <script type="module">
            import { init, requestDevice, leftDevice, rightDevice } from 'bifrost-pulse-web';
            await init();

            function setupDevice(side, pulseDevice) {
                document.querySelector('#left .cal-flat').addEventListener('click', _ => {
                    // Set the lower pull bounds to the current state
                    for(let finger in pulseDevice.pull) {
                        pulseDevice.pullCalibration[finger].min = pulseDevice.pull[finger];
                    }
                });
                document.querySelector('#left .cal-fist').addEventListener('click', _ => {
                    // Set the lower pull bounds to the current state
                    for(let finger in pulseDevice.pull) {
                        pulseDevice.pullCalibration[finger].max = pulseDevice.pull[finger];
                    }
                });
                pulseDevice.addEventListener('input', e => {
                    for(let finger in pulseDevice.pull) {
                        document.querySelector(`#${side} .pull.${finger}`).setAttribute('value', pulseDevice.pull[finger]);
                        document.querySelector(`#${side} .pull-normalized.${finger}`).setAttribute('value', pulseDevice.pullNormalized[finger]);
                    }
                });
            }
            if(leftDevice) {
                setupDevice('left', leftDevice);
            }
            if(rightDevice) {
                setupDevice('right', rightDevice);
            }

            document.querySelector('#connect-btn').addEventListener('click', e => {
                requestDevice();
            });
        </script>
        <style>
            #container {
                display: flex;
                justify-content: space-around;
            }

            #left, #right {
                display: flex;
                flex-direction: column;
            }
        </style>
    </head>
    <body>
        <h1>Bifrost Pulse Web</h1>
        <button id="connect-btn">Connect</button>
        <div id="container">
            <div id="left">
                <h3>Left</h3>
                <progress class="thumb pull" value="0" max="16383"></progress>
                <progress class="index pull" value="0" max="16383"></progress>
                <progress class="middle pull" value="0" max="16383"></progress>
                <progress class="ring pull" value="0" max="16383"></progress>
                <progress class="pinky pull" value="0" max="16383"></progress>

                <p>Normalized:</p>
                <div>
                    <button class="cal-flat">Flat hand</button>
                    <button class="cal-fist">Fist</button>
                </div>
                <progress class="thumb pull-normalized" value="0" max="1"></progress>
                <progress class="index pull-normalized" value="0" max="1"></progress>
                <progress class="middle pull-normalized" value="0" max="1"></progress>
                <progress class="ring pull-normalized" value="0" max="1"></progress>
                <progress class="pinky pull-normalized" value="0" max="1"></progress>
            </div>
            <div id="right">
                <h3>Right</h3>
                <progress class="thumb pull" value="0" max="16383"></progress>
                <progress class="index pull" value="0" max="16383"></progress>
                <progress class="middle pull" value="0" max="16383"></progress>
                <progress class="ring pull" value="0" max="16383"></progress>
                <progress class="pinky pull" value="0" max="16383"></progress>
            </div>
        </div>
    </body>
</html>